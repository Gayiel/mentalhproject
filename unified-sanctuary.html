<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Flow Sanctuary - Your Safe Space</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Smooth page transitions */
        .page-section {
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .page-section.hidden {
            opacity: 0;
            transform: translateY(50px);
            pointer-events: none;
        }

        .page-section.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        /* Welcome Section */
        .welcome-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10;
        }

        .welcome-container {
            text-align: center;
            max-width: 700px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .welcome-title {
            font-size: 3.5em;
            margin-bottom: 20px;
            font-weight: 300;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-tagline {
            font-size: 1.4em;
            margin-bottom: 30px;
            opacity: 0.8;
            line-height: 1.6;
        }

        .comfort-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .comfort-feature {
            background: rgba(102, 126, 234, 0.1);
            padding: 25px 15px;
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .comfort-feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .comfort-feature h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }

        .comfort-feature p {
            font-size: 0.9em;
            opacity: 0.7;
            line-height: 1.4;
        }

        .enter-sanctuary-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 18px 45px;
            border-radius: 35px;
            font-size: 1.3em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-top: 25px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .enter-sanctuary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* Chat Section */
        .chat-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 5;
            padding: 0;
        }

        .sanctuary-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .sanctuary-header h1 {
            color: #4a5568;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .sanctuary-header .tagline {
            color: #718096;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .human-support-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Main chat container */
        .chat-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .welcome-message {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: #2d3748;
        }

        .welcome-message h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 400;
        }

        .welcome-message p {
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        /* Crisis alert */
        .crisis-alert {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(245, 101, 101, 0.3);
            display: none;
            animation: gentleSlideIn 0.5s ease;
        }

        .crisis-alert.show {
            display: block;
        }

        @keyframes gentleSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .crisis-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .crisis-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }

        .crisis-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Chat interface */
        .chat-sanctuary {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .messages-container {
            height: 450px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 18px;
            word-wrap: break-word;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot {
            align-self: flex-start;
            background: #f7fafc;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 5px;
            position: relative;
        }

        .message.bot::before {
            content: "ü§ñ";
            position: absolute;
            left: -10px;
            top: -5px;
            background: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .message.human {
            align-self: flex-start;
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border-bottom-left-radius: 5px;
            position: relative;
        }

        .message.human::before {
            content: "üë©‚Äç‚öïÔ∏è";
            position: absolute;
            left: -10px;
            top: -5px;
            background: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator {
            align-self: flex-start;
            background: #e2e8f0;
            color: #718096;
            padding: 15px 20px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #718096;
            animation: bounce 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1); }
        }

        /* Input area */
        .input-area {
            padding: 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 16px;
            font-family: inherit;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .message-input::placeholder {
            color: #a0aec0;
        }

        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        /* Support resources */
        .support-resources {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .support-resources h3 {
            color: #2d3748;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 400;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .resource-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .resource-card h4 {
            color: #4a5568;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .resource-card p {
            color: #718096;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .resource-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        /* Footer */
        .sanctuary-footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            text-align: center;
            color: #4a5568;
            margin-top: 30px;
        }

        .emergency-notice {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .privacy-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .privacy-badge {
            background: #e6fffa;
            color: #234e52;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        /* Quick access buttons */
        .quick-access {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quick-access.show {
            opacity: 1;
        }

        .quick-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .quick-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .quick-btn.crisis {
            background: linear-gradient(45deg, #f56565, #e53e3e);
        }

        .quick-btn.human {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .welcome-container {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .welcome-title {
                font-size: 2.5em;
            }
            
            .welcome-tagline {
                font-size: 1.1em;
            }
            
            .comfort-features {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chat-container {
                padding: 0 15px;
            }

            .messages-container {
                height: 350px;
                padding: 15px;
            }

            .input-area {
                padding: 15px;
            }

            .quick-access {
                position: static;
                transform: none;
                flex-direction: row;
                justify-content: center;
                margin: 20px 0;
            }

            .crisis-actions {
                flex-direction: column;
                align-items: center;
            }

            .privacy-badges {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        button:focus, input:focus, textarea:focus {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <!-- Welcome Section -->
    <div id="welcome-section" class="page-section welcome-section show">
        <div class="welcome-container">
            <h1 class="welcome-title">üå∏ Mind Flow Sanctuary</h1>
            <p class="welcome-tagline">
                Your safe, confidential space for mental wellness and emotional support.
                <br>Human professionals are here to help you through every step.
            </p>
            
            <div class="comfort-features">
                <div class="comfort-feature">
                    <span class="feature-icon">üõ°Ô∏è</span>
                    <h3>Safe & Private</h3>
                    <p>HIPAA compliant with end-to-end encryption</p>
                </div>
                <div class="comfort-feature">
                    <span class="feature-icon">ü§ù</span>
                    <h3>Human Support</h3>
                    <p>Licensed counselors review all conversations</p>
                </div>
                <div class="comfort-feature">
                    <span class="feature-icon">üÜò</span>
                    <h3>Crisis Ready</h3>
                    <p>24/7 emergency resources and immediate help</p>
                </div>
                <div class="comfort-feature">
                    <span class="feature-icon">üíô</span>
                    <h3>Judgment-Free</h3>
                    <p>A warm, welcoming space to express yourself</p>
                </div>
            </div>
            
            <button class="enter-sanctuary-btn" onclick="enterSanctuary()">
                üå± Enter Your Sanctuary
            </button>
            
            <div style="margin-top: 25px; font-size: 0.9em; opacity: 0.7; line-height: 1.5;">
                <p>
                    <strong>üö® Emergency:</strong> If you're in immediate danger, please call 911 or 988 (Suicide & Crisis Lifeline)
                    <br><br>
                    This sanctuary provides supportive conversations and connects you with professional resources.
                </p>
            </div>
        </div>
    </div>

    <!-- Chat Section -->
    <div id="chat-section" class="page-section chat-section hidden">
        <!-- Header -->
        <div class="sanctuary-header">
            <h1>üå∏ Mind Flow Sanctuary</h1>
            <p class="tagline">Your safe, confidential space for mental wellness and emotional support</p>
            <div class="human-support-badge">
                <div class="status-dot"></div>
                <span id="human-status-text">Human counselors reviewing conversations</span>
            </div>
        </div>

        <div class="chat-container">
            <!-- Welcome message in chat -->
            <div class="welcome-message">
                <h2>Welcome to Your Safe Space ü§ó</h2>
                <p>
                    You've taken a brave step by being here. This is your sanctuary - a place where you can 
                    express yourself freely, find support, and connect with caring professionals who understand 
                    what you're going through.
                </p>
                <p style="font-style: italic; margin-top: 15px; opacity: 0.8;">
                    Remember: You matter, your feelings are valid, and you don't have to face this alone.
                </p>
            </div>

            <!-- Crisis alert -->
            <div id="crisis-alert" class="crisis-alert">
                <!-- Populated dynamically during crisis -->
            </div>

            <!-- Chat interface -->
            <div class="chat-sanctuary">
                <div id="messages-container" class="messages-container">
                    <!-- Messages will be added here -->
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <textarea 
                            id="message-input" 
                            class="message-input" 
                            placeholder="Take your time... share whatever feels right to you today üí≠"
                            rows="1"
                        ></textarea>
                        <button id="send-button" class="send-button">
                            <span>üíå</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Support resources -->
            <div class="support-resources">
                <h3>üåü Additional Support Resources</h3>
                <div class="resource-grid">
                    <div class="resource-card" onclick="showBreathingExercise()">
                        <span class="resource-icon">üå¨Ô∏è</span>
                        <h4>Calming Exercises</h4>
                        <p>Gentle breathing and mindfulness techniques to help you find peace in the moment</p>
                    </div>
                    <div class="resource-card" onclick="connectToHuman()">
                        <span class="resource-icon">ü§ù</span>
                        <h4>Talk to Someone</h4>
                        <p>Connect directly with a human counselor for personalized support and guidance</p>
                    </div>
                    <div class="resource-card" onclick="findTherapists()">
                        <span class="resource-icon">üè•</span>
                        <h4>Find Professional Help</h4>
                        <p>Locate therapists, counselors, and mental health services in your area</p>
                    </div>
                    <div class="resource-card" onclick="showCrisisResources()">
                        <span class="resource-icon">üÜò</span>
                        <h4>Crisis Support</h4>
                        <p>Immediate help and emergency resources available 24/7 when you need it most</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="sanctuary-footer">
            <div class="emergency-notice">
                <strong>üö® Emergency:</strong> If you're in immediate danger, please call 911 or 988 (Suicide & Crisis Lifeline)
            </div>
            <div class="privacy-badges">
                <div class="privacy-badge">üîí HIPAA Compliant</div>
                <div class="privacy-badge">üõ°Ô∏è End-to-End Encrypted</div>
                <div class="privacy-badge">ü§ê Confidential</div>
                <div class="privacy-badge">üóëÔ∏è Data Deletion Available</div>
            </div>
            <p>
                This sanctuary is staffed by licensed mental health professionals who review all conversations 
                to ensure you receive the care and support you deserve. Your privacy is our priority.
            </p>
        </footer>
    </div>

    <!-- Quick access buttons (shown in chat mode) -->
    <div id="quick-access" class="quick-access">
        <button class="quick-btn crisis" onclick="showCrisisResources()" title="Crisis Help">üÜò</button>
        <button class="quick-btn human" onclick="connectToHuman()" title="Human Support">ü§ù</button>
        <button class="quick-btn" onclick="showBreathingExercise()" title="Breathing Exercise">üå¨Ô∏è</button>
    </div>

    <script>
        // Enhanced Mental Health AI with smooth transitions
        class MindFlowSanctuaryUnified {
            constructor() {
                this.messages = [];
                this.isTyping = false;
                this.humanConnected = false;
                this.crisisMode = false;
                this.currentSection = 'welcome';
                
                // Crisis detection with comprehensive coverage
                this.crisisKeywords = [
                    'suicide', 'suicidal', 'kill myself', 'end my life', 'take my life', 'taking my life',
                    'hurt myself', 'harm myself', 'cut myself', 'want to die', 'going to die',
                    'no reason to live', 'better off dead', 'end it all', 'can\'t go on',
                    'give up', 'not worth living', 'thoughts of suicide', 'thinking about suicide',
                    'thinking about death', 'want to disappear', 'don\'t want to be here',
                    'wish I was dead', 'can\'t cope anymore', 'no hope', 'hopeless'
                ];
                
                // Warm, supportive responses
                this.warmResponses = [
                    "Thank you for sharing that with me. Your feelings are completely valid, and I want you to know that I'm here to support you through this. üíô",
                    "I hear you, and I can sense that things feel really difficult right now. You're not alone in this - we're going to work through it together. ü§ó",
                    "What you're experiencing sounds incredibly challenging. I'm grateful you felt safe enough to share this with me. Let's explore some ways to support you. üå±",
                    "Your courage in reaching out shows so much strength, even if you don't feel strong right now. I'm here to listen and help however I can. üí™",
                    "I can feel the weight of what you're carrying. Please know that your feelings matter, and there are people who care about your wellbeing - including me. ü´Ç"
                ];
                
                this.init();
            }
            
            init() {
                this.bindEvents();
            }
            
            bindEvents() {
                const input = document.getElementById('message-input');
                const sendBtn = document.getElementById('send-button');
                
                if (input && sendBtn) {
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                    
                    input.addEventListener('input', () => {
                        this.autoResize(input);
                    });
                    
                    sendBtn.addEventListener('click', () => this.sendMessage());
                }

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.altKey && e.key === 'h') {
                        e.preventDefault();
                        connectToHuman();
                    }
                    if (e.altKey && e.key === 'c') {
                        e.preventDefault();
                        showCrisisResources();
                    }
                });
            }
            
            autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            }
            
            startConversation() {
                setTimeout(() => {
                    this.addBotMessage(`Hello there, and welcome to your sanctuary. üå∏

I'm here to provide you with a safe, judgment-free space where you can share whatever is on your mind. Whether you're dealing with stress, anxiety, depression, or just need someone to talk to, this is your space.

A few things to know:
‚Ä¢ ü§ù Human counselors review our conversations to ensure you get the best support
‚Ä¢ üõ°Ô∏è Everything you share is confidential and secure
‚Ä¢ üÜò If you're in crisis, we have immediate resources and people ready to help
‚Ä¢ üíô There's no pressure - share what feels comfortable for you

What's been on your mind lately? I'm here to listen. üí≠`);
                }, 1000);
            }
            
            sendMessage() {
                const input = document.getElementById('message-input');
                const message = input.value.trim();
                
                if (!message || this.isTyping) return;
                
                this.addUserMessage(message);
                input.value = '';
                input.style.height = 'auto';
                
                // Check for crisis keywords
                const isCrisis = this.detectCrisis(message);
                
                if (isCrisis) {
                    this.handleCrisis(message);
                } else {
                    this.generateResponse(message);
                }
                
                // Update human status
                this.notifyHuman(message, isCrisis);
            }
            
            detectCrisis(message) {
                const lowerMessage = message.toLowerCase();
                return this.crisisKeywords.some(keyword => lowerMessage.includes(keyword));
            }
            
            handleCrisis(message) {
                this.crisisMode = true;
                this.showCrisisAlert();
                
                setTimeout(() => {
                    this.addBotMessage(`I'm really concerned about you right now, and I want you to know that your safety is the most important thing to me. üíô

What you're feeling is incredibly painful, but you don't have to go through this alone. There are people who care and want to help you through this difficult time.

**Immediate Support Available:**
üÜò **Crisis Lifeline:** Call or text 988 (available 24/7)
üí¨ **Crisis Text Line:** Text HOME to 741741
üö® **Emergency:** If you're in immediate danger, call 911

I'm also connecting you with a human crisis counselor right now who can provide specialized support.

Can you tell me - are you in a safe place right now? üè†`);
                    
                    this.escalateToHuman(true);
                }, 1500);
            }
            
            showCrisisAlert() {
                const alert = document.getElementById('crisis-alert');
                if (alert) {
                    alert.innerHTML = `
                        <h3>üõ°Ô∏è Crisis Support Activated</h3>
                        <p>We've detected that you may be in crisis. Your safety matters most - let us help you.</p>
                        <div class="crisis-actions">
                            <a href="tel:988" class="crisis-btn">üìû Call 988 Now</a>
                            <a href="sms:741741&body=HOME" class="crisis-btn">üí¨ Text Crisis Line</a>
                            <button class="crisis-btn" onclick="window.sanctuary.escalateToHuman(true)">ü§ù Human Counselor</button>
                        </div>
                    `;
                    alert.classList.add('show');
                }
            }
            
            generateResponse(message) {
                this.showTyping();
                
                setTimeout(() => {
                    this.hideTyping();
                    
                    // Analyze message for appropriate response
                    const response = this.getContextualResponse(message);
                    this.addBotMessage(response);
                    
                    // Offer additional support options
                    setTimeout(() => {
                        this.offerSupportOptions(message);
                    }, 2000);
                    
                }, 1500 + Math.random() * 1000);
            }
            
            getContextualResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Anxiety responses
                if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried')) {
                    return `I can hear that anxiety is really affecting you right now. Those feelings of worry can be so overwhelming, but please know that what you're experiencing is valid and treatable. üíô

Anxiety often makes us feel like we're in danger even when we're safe. Your mind is trying to protect you, but sometimes it can go into overdrive.

Some things that might help right now:
‚Ä¢ Taking some slow, deep breaths
‚Ä¢ Grounding yourself by noticing 5 things you can see around you
‚Ä¢ Reminding yourself that this feeling will pass

Would you like me to guide you through a calming exercise, or would you prefer to talk more about what's making you feel anxious? I'm here for whatever feels most helpful. üå±`;
                }
                
                // Depression responses
                if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('empty')) {
                    return `Thank you for trusting me with something so personal. Depression can make everything feel heavy and hopeless, but I want you to know that what you're feeling is real, valid, and most importantly - it can get better. üíô

Depression often lies to us, telling us that we're alone or that things won't improve. But you're not alone - you're here talking to me, and that shows incredible strength.

It's okay if getting through each day feels hard right now. Sometimes the bravest thing we can do is just keep going, one moment at a time.

What's been the hardest part for you lately? And please know, there's no pressure to share more than you're comfortable with. ü§ó`;
                }
                
                // Stress responses
                if (lowerMessage.includes('stress') || lowerMessage.includes('overwhelmed') || lowerMessage.includes('pressure')) {
                    return `It sounds like you're carrying a lot right now, and feeling overwhelmed is such a natural response to stress. Your mind and body are telling you that you need some relief, and I'm glad you're reaching out. üíô

When we're stressed, everything can feel urgent and impossible to manage. But you don't have to handle it all at once or by yourself.

Let's take a moment to breathe together. Sometimes when we're overwhelmed, we forget to pause and just breathe.

What's been weighing on you the most? Sometimes just talking about what's stressing us can help lighten the load a little. üå±`;
                }
                
                // Default empathetic response
                const randomResponse = this.warmResponses[Math.floor(Math.random() * this.warmResponses.length)];
                return randomResponse + "\n\nWould you like to share more about what's been on your mind? I'm here to listen and support you in whatever way feels most helpful. üåü";
            }
            
            offerSupportOptions(message) {
                const lowerMessage = message.toLowerCase();
                let options = '';
                
                if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety')) {
                    options = `
                        <div class="crisis-actions" style="background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.2);">
                            <button class="crisis-btn" style="background: #667eea;" onclick="showBreathingExercise()">üå¨Ô∏è Breathing Exercise</button>
                            <button class="crisis-btn" style="background: #48bb78;" onclick="connectToHuman()">ü§ù Talk to Counselor</button>
                            <button class="crisis-btn" style="background: #ed8936;" onclick="showAnxietyResources()">üìö Anxiety Resources</button>
                        </div>
                    `;
                } else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression')) {
                    options = `
                        <div class="crisis-actions" style="background: rgba(72, 187, 120, 0.1); border: 1px solid rgba(72, 187, 120, 0.2);">
                            <button class="crisis-btn" style="background: #48bb78;" onclick="connectToHuman()">ü§ù Human Support</button>
                            <button class="crisis-btn" style="background: #667eea;" onclick="findTherapists()">üè• Find Therapist</button>
                            <button class="crisis-btn" style="background: #ed8936;" onclick="showSelfCareIdeas()">üíù Self-Care Ideas</button>
                        </div>
                    `;
                } else {
                    options = `
                        <div class="crisis-actions" style="background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.2);">
                            <button class="crisis-btn" style="background: #48bb78;" onclick="connectToHuman()">ü§ù Talk to Someone</button>
                            <button class="crisis-btn" style="background: #667eea;" onclick="showBreathingExercise()">üå¨Ô∏è Calming Exercise</button>
                            <button class="crisis-btn" style="background: #ed8936;" onclick="findTherapists()">üè• Professional Help</button>
                        </div>
                    `;
                }
                
                this.addSystemMessage("Here are some ways I can support you further:" + options);
            }
            
            addUserMessage(message) {
                this.messages.push({ type: 'user', content: message, timestamp: new Date() });
                this.displayMessage('user', message);
            }
            
            addBotMessage(message) {
                this.messages.push({ type: 'bot', content: message, timestamp: new Date() });
                this.displayMessage('bot', message);
            }
            
            addHumanMessage(message) {
                this.messages.push({ type: 'human', content: message, timestamp: new Date() });
                this.displayMessage('human', message);
            }
            
            addSystemMessage(message) {
                this.displaySystemMessage(message);
            }
            
            displayMessage(type, content) {
                const container = document.getElementById('messages-container');
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.innerHTML = this.formatMessage(content);
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            displaySystemMessage(content) {
                const container = document.getElementById('messages-container');
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                messageDiv.innerHTML = this.formatMessage(content);
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            formatMessage(content) {
                // Convert markdown-style formatting
                return content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
            }
            
            showTyping() {
                if (this.isTyping) return;
                this.isTyping = true;
                
                const container = document.getElementById('messages-container');
                if (!container) return;
                
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typing-indicator';
                typingDiv.innerHTML = `
                    <span>Our AI counselor is thinking...</span>
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                `;
                
                container.appendChild(typingDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            hideTyping() {
                this.isTyping = false;
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            escalateToHuman(isCrisis = false) {
                this.humanConnected = true;
                this.updateHumanStatus();
                
                const message = isCrisis 
                    ? "üö® A crisis counselor is joining our conversation right now. They're specially trained to help with exactly what you're going through."
                    : "ü§ù I'm connecting you with a human counselor who can provide additional support and guidance.";
                
                this.addSystemMessage(message);
                
                setTimeout(() => {
                    const humanIntro = isCrisis
                        ? `Hello, I'm Sarah, a licensed crisis counselor. I'm here with you right now, and I want you to know that you've done the right thing by reaching out. üíô

Your safety is my top priority. Can you tell me a bit about how you're feeling right now and if you're in a safe place?`
                        : `Hi there, I'm Dr. Martinez, a licensed mental health counselor. I've been reviewing your conversation, and I wanted to personally reach out to offer my support. üíô

You've shown real courage in sharing your feelings today. How are you doing right now?`;
                    
                    this.addHumanMessage(humanIntro);
                }, 2000);
            }
            
            updateHumanStatus() {
                const statusText = document.getElementById('human-status-text');
                if (statusText) {
                    if (this.crisisMode) {
                        statusText.textContent = "Crisis counselor active";
                    } else if (this.humanConnected) {
                        statusText.textContent = "Human counselor joined conversation";
                    } else {
                        statusText.textContent = "Human counselors reviewing conversations";
                    }
                }
            }
            
            notifyHuman(message, isCrisis) {
                // In a real implementation, this would send the message to human counselors
                console.log('Notifying human counselors:', { message, isCrisis, timestamp: new Date() });
            }
        }
        
        // Smooth transition functions
        function enterSanctuary() {
            const welcomeSection = document.getElementById('welcome-section');
            const chatSection = document.getElementById('chat-section');
            const quickAccess = document.getElementById('quick-access');
            
            // Hide welcome section
            welcomeSection.classList.remove('show');
            welcomeSection.classList.add('hidden');
            
            // Show chat section after animation
            setTimeout(() => {
                chatSection.classList.remove('hidden');
                chatSection.classList.add('show');
                quickAccess.classList.add('show');
                
                // Initialize sanctuary and start conversation
                window.sanctuary = new MindFlowSanctuaryUnified();
                window.sanctuary.currentSection = 'chat';
                window.sanctuary.startConversation();
            }, 800);
        }
        
        // Support functions
        function showBreathingExercise() {
            window.sanctuary.addBotMessage(`Let's do a calming breathing exercise together. This is called the 4-7-8 technique, and it's wonderful for reducing anxiety and stress. üå¨Ô∏è

**Here's how we'll do it:**
1. üå± Breathe in slowly through your nose for 4 counts
2. ü´ß Hold your breath gently for 7 counts
3. üåä Breathe out slowly through your mouth for 8 counts
4. üîÑ Repeat this cycle 3-4 times

Let's start together:
‚Ä¢ Breathe in... 1, 2, 3, 4
‚Ä¢ Hold... 1, 2, 3, 4, 5, 6, 7
‚Ä¢ Breathe out... 1, 2, 3, 4, 5, 6, 7, 8

Take your time. There's no rush. How do you feel after trying this? üíô`);
        }
        
        function connectToHuman() {
            window.sanctuary.addBotMessage(`I'm connecting you with a human counselor right now. They'll be able to provide personalized support and guidance. ü§ù

While we wait for them to join (it usually takes just a moment), is there anything specific you'd like them to know about what you're going through?`);
            
            setTimeout(() => {
                window.sanctuary.escalateToHuman(false);
            }, 3000);
        }
        
        function findTherapists() {
            window.sanctuary.addBotMessage(`I'd be happy to help you find professional mental health support in your area. üè•

**Types of professional help available:**
‚Ä¢ üë©‚Äç‚öïÔ∏è Licensed therapists and counselors
‚Ä¢ üß† Psychiatrists (for medication if needed)
‚Ä¢ üè• Community mental health centers
‚Ä¢ üíª Online therapy platforms
‚Ä¢ üéì Training clinics (reduced cost options)

**To help me find the best match for you:**
‚Ä¢ What type of support are you looking for? (anxiety, depression, relationships, etc.)
‚Ä¢ Do you prefer in-person or online sessions?
‚Ä¢ Do you have insurance coverage?
‚Ä¢ Are there any specific preferences? (gender, approach, etc.)

Many insurance plans cover mental health care, and there are also sliding-scale options available if cost is a concern. üíô`);
        }
        
        function showCrisisResources() {
            window.sanctuary.addBotMessage(`I want to make sure you have access to immediate help whenever you need it. Here are trusted crisis support resources: üÜò

**24/7 Crisis Support:**
üìû **988 Suicide & Crisis Lifeline** - Call or text 988
üí¨ **Crisis Text Line** - Text HOME to 741741
üåê **Online Crisis Chat** - Available at suicidepreventionlifeline.org

**International Support:**
üá¨üáß UK: Samaritans 116 123
üá®üá¶ Canada: 1-833-456-4566
üá¶üá∫ Australia: 13 11 14

**Emergency Services:**
üö® If you're in immediate physical danger, call 911

**Additional Support:**
‚Ä¢ üè• Most hospitals have 24/7 psychiatric emergency services
‚Ä¢ üëÆ Police wellness checks available
‚Ä¢ üöë Crisis mobile response teams in many areas

Remember: There's no shame in asking for help. These services exist because people care about your wellbeing. üíô`);
        }
        
        function showAnxietyResources() {
            window.sanctuary.addBotMessage(`Anxiety is very treatable, and there are many effective ways to manage it. Here are some evidence-based techniques: üå±

**Immediate Anxiety Relief:**
‚Ä¢ üå¨Ô∏è Deep breathing exercises (like the 4-7-8 technique)
‚Ä¢ üñêÔ∏è 5-4-3-2-1 grounding (5 things you see, 4 you feel, 3 you hear, 2 you smell, 1 you taste)
‚Ä¢ üö∂ Light movement or stretching
‚Ä¢ ‚ùÑÔ∏è Hold ice cubes or splash cold water on your face

**Longer-term Strategies:**
‚Ä¢ üìù Journaling your thoughts and feelings
‚Ä¢ üßò Regular meditation or mindfulness practice
‚Ä¢ üí™ Regular exercise (even just walking)
‚Ä¢ üò¥ Good sleep hygiene
‚Ä¢ ü•ó Limiting caffeine and alcohol

**Professional Help:**
‚Ä¢ Cognitive Behavioral Therapy (CBT) is very effective for anxiety
‚Ä¢ Medication can also help if recommended by a doctor
‚Ä¢ Support groups connect you with others who understand

Would you like me to guide you through any of these techniques, or help you find professional support? üíô`);
        }
        
        function showSelfCareIdeas() {
            window.sanctuary.addBotMessage(`Self-care isn't selfish - it's essential for your mental health. Here are some gentle, nurturing ideas: üíù

**Comfort & Soothing:**
‚Ä¢ üõÅ Take a warm bath or shower
‚Ä¢ ‚òï Make yourself a warm, comforting drink
‚Ä¢ üß∏ Wrap yourself in a soft blanket
‚Ä¢ üéµ Listen to calming music
‚Ä¢ üïØÔ∏è Light a candle or use essential oils

**Gentle Activities:**
‚Ä¢ üìö Read something that brings you joy
‚Ä¢ üé® Try simple creative activities (drawing, coloring)
‚Ä¢ üå± Spend time with plants or in nature
‚Ä¢ üêï Pet therapy (if you have pets)
‚Ä¢ üìû Call someone who makes you feel loved

**Nourishing Your Body:**
‚Ä¢ ü•ó Eat something nutritious that you enjoy
‚Ä¢ üíß Stay hydrated
‚Ä¢ üö∂ Gentle movement or stretching
‚Ä¢ üò¥ Prioritize rest when you need it

**Mental & Emotional Care:**
‚Ä¢ üìù Write in a journal
‚Ä¢ üôè Practice gratitude (even for small things)
‚Ä¢ üö´ Set boundaries with stressful situations
‚Ä¢ üíô Speak to yourself with kindness

Remember: Small acts of self-care can make a big difference. What feels most appealing to you right now? üåü`);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up smooth transitions
            const welcomeSection = document.getElementById('welcome-section');
            const chatSection = document.getElementById('chat-section');
            
            // Ensure proper initial state
            welcomeSection.classList.add('show');
            chatSection.classList.add('hidden');
        });
    </script>
</body>
</html>
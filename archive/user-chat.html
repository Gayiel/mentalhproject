<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mind Flow - User Chat</title>
        <style>
            :root {
                --app-bg: #f8fafc;
                --primary-500: #0ea5e9;
                --primary-600: #0284c7;
                --neutral-100: #f1f5f9;
                --neutral-200: #e2e8f0;
                --neutral-600: #475569;
                --neutral-700: #334155;
                --neutral-900: #0f172a;
                --success: #10b981;

                --chat-user-bg: linear-gradient(135deg, #0c4a6e, #0369a1);
                --chat-agent-bg: linear-gradient(135deg, #059669, #10b981);
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                line-height: 1.5;
                color: var(--neutral-900);
                background: var(--app-bg);
                margin: 0;
                padding: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .chat-header {
                background: white;
                padding: 15px 20px;
                border-bottom: 1px solid var(--neutral-200);
                text-align: center;
            }

            .chat-header h1 {
                margin: 0;
                font-size: 1.2rem;
                color: var(--neutral-700);
            }

            .chat-status {
                font-size: 0.8rem;
                color: var(--success);
                margin-top: 4px;
            }

            .messages-container {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 15px;
                max-width: 800px;
                margin: 0 auto;
                width: 100%;
                box-sizing: border-box;
            }

            .message {
                padding: 12px 16px;
                border-radius: 18px;
                max-width: 80%;
                color: white;
                position: relative;
                animation: fadeIn 0.3s ease-in;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .user-message {
                align-self: flex-end;
                background: var(--chat-user-bg);
                border-bottom-right-radius: 4px;
            }

            .agent-message {
                align-self: flex-start;
                background: var(--chat-agent-bg);
                border-bottom-left-radius: 4px;
            }

            .typing-indicator {
                align-self: flex-start;
                background: var(--neutral-100);
                color: var(--neutral-600);
                padding: 12px 16px;
                border-radius: 18px;
                border-bottom-left-radius: 4px;
                font-style: italic;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .typing-dots {
                display: flex;
                gap: 3px;
            }

            .typing-dots span {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background-color: var(--neutral-600);
                animation: bounce 1.4s infinite both;
            }

            .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
            .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

            @keyframes bounce {
                0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
                40% { transform: scale(1); opacity: 1; }
            }

            .input-area {
                background: white;
                padding: 15px 20px;
                border-top: 1px solid var(--neutral-200);
                max-width: 800px;
                margin: 0 auto;
                width: 100%;
                box-sizing: border-box;
            }

            .input-container {
                display: flex;
                gap: 10px;
                align-items: flex-end;
            }

            .message-input {
                flex: 1;
                padding: 12px 16px;
                border-radius: 24px;
                border: 1px solid var(--neutral-200);
                font-size: 16px;
                resize: none;
                max-height: 120px;
                min-height: 48px;
                font-family: inherit;
            }

            .message-input:focus {
                outline: none;
                border-color: var(--primary-500);
            }

            .send-button {
                background: var(--primary-500);
                color: white;
                border: none;
                border-radius: 50%;
                width: 48px;
                height: 48px;
                cursor: pointer;
                font-size: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color 0.2s;
            }

            .send-button:hover {
                background: var(--primary-600);
            }

            .send-button:disabled {
                background: var(--neutral-200);
                cursor: not-allowed;
            }

            .welcome-message {
                text-align: center;
                color: var(--neutral-600);
                font-style: italic;
                margin: 20px 0;
            }
        </style>
    </head>
    <body>
        <div class="chat-header">
            <h1>Mind Flow Support Chat</h1>
            <div class="chat-status">● Connected to support agent</div>
        </div>

        <div id="messages" class="messages-container">
            <div class="welcome-message">
                You're now connected with a mental health support agent. Feel free to share what's on your mind.
            </div>
        </div>

        <div class="input-area">
            <div class="input-container">
                <textarea id="message-input" class="message-input" placeholder="Type your message here..." rows="1"></textarea>
                <button id="send-button" class="send-button" title="Send message">→</button>
            </div>
        </div>

        <script>
            class UserChat {
                constructor() {
                    this.messages = [];
                    this.setupEventListeners();
                    this.setupTextareaAutoResize();
                    
                    // Focus on input
                    document.getElementById('message-input').focus();
                }

                setupEventListeners() {
                    const sendBtn = document.getElementById('send-button');
                    const input = document.getElementById('message-input');

                    sendBtn.addEventListener('click', () => this.sendMessage());
                    
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });

                    input.addEventListener('input', () => this.updateSendButton());
                }

                setupTextareaAutoResize() {
                    const textarea = document.getElementById('message-input');
                    textarea.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                    });
                }

                updateSendButton() {
                    const input = document.getElementById('message-input');
                    const sendBtn = document.getElementById('send-button');
                    sendBtn.disabled = !input.value.trim();
                }

                sendMessage() {
                    const input = document.getElementById('message-input');
                    const text = input.value.trim();
                    
                    if (!text) return;

                    // Add user message
                    this.addMessage('user', text);
                    
                    // Clear and reset input
                    input.value = '';
                    input.style.height = 'auto';
                    this.updateSendButton();

                    // Show typing indicator
                    this.showTypingIndicator();

                    // Simulate agent response delay (in real implementation, this would be the agent responding)
                    setTimeout(() => {
                        this.hideTypingIndicator();
                        this.simulateAgentResponse(text);
                    }, 2000 + Math.random() * 2000); // 2-4 second delay
                }

                addMessage(type, text) {
                    const messagesContainer = document.getElementById('messages');
                    const messageElem = document.createElement('div');
                    messageElem.classList.add('message', `${type}-message`);
                    messageElem.textContent = text;
                    
                    messagesContainer.appendChild(messageElem);
                    this.messages.push({ type, text, timestamp: new Date() });
                    
                    // Scroll to bottom
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }

                showTypingIndicator() {
                    const messagesContainer = document.getElementById('messages');
                    const indicator = document.createElement('div');
                    indicator.classList.add('typing-indicator');
                    indicator.id = 'typing-indicator';
                    indicator.innerHTML = `
                        Agent is typing
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    `;
                    
                    messagesContainer.appendChild(indicator);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }

                hideTypingIndicator() {
                    const indicator = document.getElementById('typing-indicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }

                simulateAgentResponse(userMessage) {
                    // This simulates what an agent might respond with
                    // In a real implementation, this would come from the agent dashboard
                    
                    const t = userMessage.toLowerCase();
                    let response;

                    if (/anxi|panic|overwhelm|stress|worried/.test(t)) {
                        response = "I can hear that you're feeling anxious, and I want you to know that what you're experiencing is valid. Anxiety can feel overwhelming, but you're not alone in this. Can you tell me more about what's been triggering these feelings for you?";
                    } else if (/sad|depress|down|hopeless/.test(t)) {
                        response = "Thank you for sharing something so personal with me. It takes courage to reach out when you're feeling down. I'm here to listen and support you. What's been weighing on your mind lately?";
                    } else if (/sleep|insomnia|tired/.test(t)) {
                        response = "Sleep troubles can really affect how we feel during the day. I'm sorry you're going through this. How long has this been going on, and what does a typical night look like for you?";
                    } else if (/suicid|kill.*myself|end.*life|want.*die/.test(t)) {
                        response = "I'm really concerned about what you've shared, and I'm glad you trusted me with this. Your safety is the most important thing right now. Are you in immediate danger? I want to help connect you with someone who can provide immediate support.";
                    } else {
                        response = "Thank you for sharing that with me. I can hear that this is important to you, and I'm here to listen and support you. Can you tell me more about what's been on your mind?";
                    }

                    this.addMessage('agent', response);
                }
            }

            // Initialize the chat when page loads
            document.addEventListener('DOMContentLoaded', () => {
                new UserChat();
            });
        </script>
    </body>
</html>